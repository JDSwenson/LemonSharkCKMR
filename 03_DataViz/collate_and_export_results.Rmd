---
title: "CKMR results 07/21/2022"
output: 
  html_document:
    df_print: tibble
    toc: true
    toc_depth: 3
    fig_caption: yes
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
#devtools::install_github("pconn/HierarchicalGOF/HierarchicalGOF")
#install.packages("ggmcmc")
library(tidyverse)
library(ggpubr)
library(RColorBrewer)
library(coda)
library(runjags)
library(ggmcmc)
library(viridis)
library(scales)
library(ggridges)
library(ggpattern)

rm(list=ls())
today <- format(Sys.Date(), "%d%b%Y")

```


```{r set-file-locations and read in files, include = FALSE}
#------------- Simulation parameters and labels  ----------------#
objective_1_MCMC_location <- "G://My Drive/Personal_Drive/R/CKMR/Objective.1_model.validation/Pre_Nov2022/Model.output/"
objective_1_results_location <- "G://My Drive/Personal_Drive/R/CKMR/Objective.1_model.validation/Pre_Nov2022/Model.results/"
objective_1_results_plots_location <- "G://My Drive/Personal_Drive/R/CKMR/Objective.1_model.validation/Pre_Nov2022/Model.results/figures/"

objective_2_MCMC_location <- "G://My Drive/Personal_Drive/R/CKMR/Objective.2_population.growth/Pre_Nov2022/Model.output/"
objective_2_results_location <- "G://My Drive/Personal_Drive/R/CKMR/Objective.2_population.growth/Pre_Nov2022/Model.results/"
objective_2_results_plots_location <- "G://My Drive/Personal_Drive/R/CKMR/Objective.2_population.growth/Pre_Nov2022/Model.results/figures/"

objective_3_MCMC_location <- "G://My Drive/Personal_Drive/R/CKMR/Objective.3_intermittent.breeding/Nov2022/Model.output/"
objective_3_results_location <- "G://My Drive/Personal_Drive/R/CKMR/Objective.3_intermittent.breeding/Nov2022/Model.results/"
objective_3_results_plots_location <- "G://My Drive/Personal_Drive/R/CKMR/Objective.3_intermittent.breeding/Nov2022/Model.results/figures/"

objective_4_MCMC_location <- "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.output/"
objective_4_results_location <- "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/"
objective_4_results_plots_location <- "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/figures/"


results_prefix <- "CKMR_results"
MCMC_prefix <- "CKMR_modelout"
parents_prefix <- "parents_breakdown/CKMR_parents.breakdown"
sample.prefix <- "sample_info/CKMR_sample.info"
pop.size.prefix <- "pop_size/CKMR_pop.size"
mom.comps.prefix <- "comparisons/mom.comps"
dad.comps.prefix <- "comparisons/dad.comps"


#-------------Objective 1 --------------------
date.of.simulation.scenario_1.1Y <- "16Aug2022"
purpose.obj1.1Y <- "Obj1.1_model.validation_Target.YOY"
file.scenario_1.1Y <- "scenario_1.1_model.validation_Target.YOY"
purpose.obj1.1.labY <- "Target YOY"
model.type.obj1.1Y <- "HS.only"

date.of.simulation.scenario_1.1J <- "16Aug2022"
purpose.obj1.1J <- "Obj1.1_model.validation_sample.all.juvenile.ages"
file.scenario_1.1J <- "scenario_1.1_model.validation_sample.all.juvenile.ages"
purpose.obj1.1.labJ <- "Sample all juvenile ages"
model.type.obj1.1J <- "HS.only"

date.of.simulation.scenario_1.1A <- "16Aug2022"
purpose.obj1.1A <- "Obj1.1_model.validation_sample.ALL.ages"
file.scenario_1.1A <- "scenario_1.1_model.validation_sample.ALL.ages"
purpose.obj1.1.labA <- "Sample all age classes"
model.type.obj1.1A <- "HS + PO"


#-------------Objective 1.2 --------------------#
#date.of.simulation.scenario_1.2Y <- "24Jul2022"
purpose.obj1.2Y <- "Obj1.2_model.validation_Target.YOY"
file.scenario_1.2Y <- "scenario_1.2_model.validation_Target.YOY"
purpose.obj1.2.labY <- "Target YOY"
model.type.obj1.2Y <- "HS.only"

#date.of.simulation.scenario_1.2J <- "24Jul2022"
purpose.obj1.2J <- "Obj1.2_model.validation_sample.all.juvenile.ages"
file.scenario_1.2J <- "scenario_1.2_model.validation_sample.all.juvenile.ages"
purpose.obj1.2.labJ <- "Sample all juvenile ages"
model.type.obj1.2J <- "HS.only"

#date.of.simulation.scenario_1.2A <- "24Jul2022"
purpose.obj1.2A <- "Obj1.2_model.validation_sample.ALL.ages"
file.scenario_1.2A <- "scenario_1.2_model.validation_sample.ALL.ages"
purpose.obj1.2.labA <- "Sample all age classes"
model.type.obj1.2A <- "HS + PO"


#-------------Objective 2 --------------------
#date.of.simulation.scenario_2.1Y <- "13Jul2022"
purpose.obj2.1Y <- c("scenario_2.1.1_lambda.trial_Target.YOY","scenario_2.1.2_lambda.extreme_Target.YOY")
file.scenario_2.1Y <- c("scenario_2.1.1_lambda.trial_Target.YOY", "scenario_2.1.2_lambda.extreme_Target.YOY")
purpose.obj2.1.labY <- "Target YOY"
model.type.obj2.1Y <- "HS.only"

#date.of.simulation.scenario_2.1J <- "13Jul2022"
purpose.obj2.1J <- c("scenario_2.1.1_lambda.trial_sample.all.juvenile.ages", "scenario_2.1.2_lambda.extreme_sample.all.juvenile.ages")
file.scenario_2.1J <- c("scenario_2.1.1_lambda.trial_sample.all.juvenile.ages", "scenario_2.1.2_lambda.extreme_sample.all.juvenile.ages")
purpose.obj2.1.labJ <- "Sample all juvenile ages"
model.type.obj2.1J <- "HS.only"

#date.of.simulation.scenario_2.1A <- "13Jul2022"
purpose.obj2.1A <- c("scenario_2.1.1_lambda.trial_sample.ALL.ages", "scenario_2.1.2_lambda.extreme_sample.ALL.ages")
file.scenario_2.1A <- c("scenario_2.1.1_lambda.trial_sample.ALL.ages", "scenario_2.1.2_lambda.extreme_sample.ALL.ages")
purpose.obj2.1.labA <- "Sample all age classes"
model.type.obj2.1A <- "HS + PO"


#-------------Objective 2.2 --------------------#
#date.of.simulation.scenario_2.2Y <- "26Jul2022"
purpose.obj2.2Y <- c("scenario_2.2.1_lambda.trial_target.YOY_change.est.yr", "scenario_2.2.2_lambda.extreme_target.YOY_change.est.yr")
file.scenario_2.2Y <- c("scenario_2.2.1_lambda.trial_target.YOY_change.est.yr", "scenario_2.2.2_lambda.extreme_target.YOY_change.est.yr")
purpose.obj2.2.labY <- "Target YOY"
model.type.obj2.2Y <- "HS.only"

#date.of.simulation.scenario_2.2J <- "26Jul2022"
purpose.obj2.2J <- c("scenario_2.2.1_lambda.trial_sample.all.juvenile.ages_change.est.yr", "scenario_2.2.2_lambda.extreme_sample.all.juvenile.ages_change.est.yr")
file.scenario_2.2J <- c("scenario_2.2.1_lambda.trial_sample.all.juvenile.ages_change.est.yr", "scenario_2.2.2_lambda.extreme_sample.all.juvenile.ages_change.est.yr")
purpose.obj2.2.labJ <- "Sample all juvenile ages"
model.type.obj2.2J <- "HS.only"

#date.of.simulation.scenario_2.2A <- "26Jul2022"
purpose.obj2.2A <- c("scenario_2.2.1_lambda.trial_sample.ALL.ages_change.est.yr", "scenario_2.2.2_lambda.extreme_sample.ALL.ages_change.est.yr")
file.scenario_2.2A <- c("scenario_2.2.1_lambda.trial_sample.ALL.ages_change.est.yr", "scenario_2.2.2_lambda.extreme_sample.ALL.ages_change.est.yr")
purpose.obj2.2.labA <- "Sample all age classes"
model.type.obj2.2A <- "HS + PO"


#-------------Objective 2.3 --------------------#
#date.of.simulation.scenario_2.3Y <- "26Jul2022"
purpose.obj2.3Y <- c("scenario_2.3.1_lambda.trial_target.YOY_change.est.yr", "scenario_2.3.2_lambda.extreme_target.YOY_change.est.yr")
file.scenario_2.3Y <- c("scenario_2.3.1_lambda.trial_target.YOY_change.est.yr", "scenario_2.3.2_lambda.extreme_target.YOY_change.est.yr")
purpose.obj2.3.labY <- "Target YOY"
model.type.obj2.3Y <- "HS.only"

#date.of.simulation.scenario_2.3J <- "26Jul2022"
purpose.obj2.3J <- c("scenario_2.3.1_lambda.trial_sample.all.juvenile.ages_change.est.yr", "scenario_2.3.2_lambda.extreme_sample.all.juvenile.ages_change.est.yr")
file.scenario_2.3J <- c("scenario_2.3.1_lambda.trial_sample.all.juvenile.ages_change.est.yr", "scenario_2.3.2_lambda.extreme_sample.all.juvenile.ages_change.est.yr")
purpose.obj2.3.labJ <- "Sample all juvenile ages"
model.type.obj2.3J <- "HS.only"

#date.of.simulation.scenario_2.3A <- "26Jul2022"
purpose.obj2.3A <- c("scenario_2.3.1_lambda.trial_sample.ALL.ages_change.est.yr", "scenario_2.3.2_lambda.extreme_sample.ALL.ages_change.est.yr")
file.scenario_2.3A <- c("scenario_2.3.1_lambda.trial_sample.ALL.ages_change.est.yr", "scenario_2.3.2_lambda.extreme_sample.ALL.ages_change.est.yr")
purpose.obj2.3.labA <- "Sample all age classes"
model.type.obj2.3A <- "HS + PO"


#-------------Objective 3 --------------------
#date.of.simulation.scenario_2.2.1Y <- "13Jul2022"
purpose.obj3.1.1Y <- c("scenario_3.1.1_SB_target.YOY", "scenario_3.1.2_SB_target.YOY", "scenario_3.1.3_SB_target.YOY")
file.scenario_3.1Y <- c("scenario_3.1.1_SB_target.YOY", "scenario_3.1.2_SB_target.YOY", "scenario_3.1.3_SB_target.YOY")
purpose.obj3.1.labY <- "Target YOY"
model.type.obj3.1Y <- "HS.only"

#date.of.simulation.scenario_3.1.1J <- "13Jul2022"
purpose.obj3.1J <- c("scenario_3.1.1_SB_sample.all.juvenile.ages", "scenario_3.1.2_SB_sample.all.juvenile.ages", "scenario_3.1.3_SB_sample.all.juvenile.ages")
file.scenario_3.1J <- c("scenario_3.1.1_SB_sample.all.juvenile.ages", "scenario_3.1.2_SB_sample.all.juvenile.ages", "scenario_3.1.3_SB_sample.all.juvenile.ages")
purpose.obj3.1.labJ <- "Sample all juvenile ages"
model.type.obj3.1J <- "HS.only"

#date.of.simulation.scenario_3.1.1A <- "13Jul2022"
purpose.obj3.1A <- c("scenario_3.1.1_SB_sample.ALL.ages", "scenario_3.1.2_SB_sample.ALL.ages", "scenario_3.1.3_SB_sample.ALL.ages")
file.scenario_3.1A <- c("scenario_3.1.1_SB_sample.ALL.ages", "scenario_3.1.2_SB_sample.ALL.ages", "scenario_3.1.3_SB_sample.ALL.ages")
purpose.obj3.1.labA <- "Sample all age classes"
model.type.obj3.1A <- "HS + PO"


#-------------Objective 3.2 --------------------#
#date.of.simulation.scenario_2.2.1Y <- "13Jul2022"
purpose.obj3.2Y <- c("scenario_3.2.1_SB_target.YOY_psi1", "scenario_3.2.2_SB_target.YOY_psi1", "scenario_3.2.3_SB_target.YOY_psi1")
file.scenario_3.2Y <- c("scenario_3.2.1_SB_target.YOY_psi1", "scenario_3.2.2_SB_target.YOY_psi1", "scenario_3.2.3_SB_target.YOY_psi1")
purpose.obj3.2.labY <- "Target YOY"
model.type.obj3.2Y <- "HS.only"

#date.of.simulation.scenario_3.2.1J <- "13Jul2022"
purpose.obj3.2J <- c("scenario_3.2.1_SB_sample.all.juvenile.ages_psi1", "scenario_3.2.2_SB_sample.all.juvenile.ages_psi1", "scenario_3.2.3_SB_sample.all.juvenile.ages_psi1")
file.scenario_3.2J <- c("scenario_3.2.1_SB_sample.all.juvenile.ages_psi1", "scenario_3.2.2_SB_sample.all.juvenile.ages_psi1", "scenario_3.2.3_SB_sample.all.juvenile.ages_psi1")
purpose.obj3.2.labJ <- "Sample all juvenile ages"
model.type.obj3.2J <- "HS.only"

#date.of.simulation.scenario_3.2.1A <- "13Jul2022"
purpose.obj3.2A <- c("scenario_3.2.1_SB_sample.ALL.ages_psi1", "scenario_3.2.2_SB_sample.ALL.ages_psi1", "scenario_3.2.3_SB_sample.ALL.ages_psi1")
file.scenario_3.2A <- c("scenario_3.2.1_SB_sample.ALL.ages_psi1", "scenario_3.2.2_SB_sample.ALL.ages_psi1", "scenario_3.2.3_SB_sample.ALL.ages_psi1")
purpose.obj3.2.labA <- "Sample all age classes"
model.type.obj3.2A <- "HS + PO"


#-------------Scenario 3.3 --------------------#
#date.of.simulation.scenario_2.2.1Y <- "13Jul2022"
purpose.obj3.3Y <- c("scenario_3.3.1_SB_target.YOY_psi0.9", "scenario_3.3.2_SB_target.YOY_psi0.9", "scenario_3.3.3_SB_target.YOY_psi0.9", "scenario_3.3.4_SB_target.YOY_psi0.9")
file.scenario_3.3Y <- c("scenario_3.3.1_SB_target.YOY_psi0.9", "scenario_3.3.2_SB_target.YOY_psi0.9", "scenario_3.3.3_SB_target.YOY_psi0.9", "scenario_3.3.4_SB_target.YOY_psi0.9")
purpose.obj3.3.labY <- "Target YOY"
model.type.obj3.3Y <- "HS.only"

#date.of.simulation.scenario_3.3.1J <- "13Jul2022"
purpose.obj3.3J <- c("scenario_3.3.1_SB_sample.all.juvenile.ages_psi0.9", "scenario_3.3.2_SB_sample.all.juvenile.ages_psi0.9", "scenario_3.3.3_SB_sample.all.juvenile.ages_psi0.9", "scenario_3.3.4_SB_sample.all.juvenile.ages_psi0.9")
file.scenario_3.3J <- c("scenario_3.3.1_SB_sample.all.juvenile.ages_psi0.9", "scenario_3.3.2_SB_sample.all.juvenile.ages_psi0.9", "scenario_3.3.3_SB_sample.all.juvenile.ages_psi0.9", "scenario_3.3.4_SB_sample.all.juvenile.ages_psi0.9")
purpose.obj3.3.labJ <- "Sample all juvenile ages"
model.type.obj3.3J <- "HS.only"

#date.of.simulation.scenario_3.3.1A <- "13Jul2022"
purpose.obj3.3A <- c("scenario_3.3.1_SB_sample.ALL.ages_psi0.9", "scenario_3.3.2_SB_sample.ALL.ages_psi0.9", "scenario_3.3.3_SB_sample.ALL.ages_psi0.9", "scenario_3.3.4_SB_sample.ALL.ages_psi0.9")
file.scenario_3.3A <- c("scenario_3.3.1_SB_sample.ALL.ages_psi0.9", "scenario_3.3.2_SB_sample.ALL.ages_psi0.9", "scenario_3.3.3_SB_sample.ALL.ages_psi0.9", "scenario_3.3.4_SB_sample.ALL.ages_psi0.9")
purpose.obj3.3.labA <- "Sample all age classes"
model.type.obj3.3A <- "HS + PO"


#-------------Scenario 3.4 --------------------#
#date.of.simulation.scenario_2.2.1Y <- "13Jul2022"
purpose.obj3.4Y <- c("scenario_3.4.1_SB_target.YOY_psi0.75", "scenario_3.4.2_SB_target.YOY_psi0.75", "scenario_3.4.3_SB_target.YOY_psi0.75", "scenario_3.4.4_SB_target.YOY_psi0.75")
file.scenario_3.4Y <- c("scenario_3.4.1_SB_target.YOY_psi0.75", "scenario_3.4.2_SB_target.YOY_psi0.75", "scenario_3.4.3_SB_target.YOY_psi0.75", "scenario_3.4.4_SB_target.YOY_psi0.75")
purpose.obj3.4.labY <- "Target YOY"
model.type.obj3.4Y <- "HS.only"

#date.of.simulation.scenario_3.4.1J <- "13Jul2022"
purpose.obj3.4J <- c("scenario_3.4.1_SB_sample.all.juvenile.ages_psi0.75", "scenario_3.4.2_SB_sample.all.juvenile.ages_psi0.75", "scenario_3.4.3_SB_sample.all.juvenile.ages_psi0.75", "scenario_3.4.4_SB_sample.all.juvenile.ages_psi0.75")
file.scenario_3.4J <- c("scenario_3.4.1_SB_sample.all.juvenile.ages_psi0.75", "scenario_3.4.2_SB_sample.all.juvenile.ages_psi0.75", "scenario_3.4.3_SB_sample.all.juvenile.ages_psi0.75", "scenario_3.4.4_SB_sample.all.juvenile.ages_psi0.75")
purpose.obj3.4.labJ <- "Sample all juvenile ages"
model.type.obj3.4J <- "HS.only"

#date.of.simulation.scenario_3.4.1A <- "13Jul2022"
purpose.obj3.4A <- c("scenario_3.4.1_SB_sample.ALL.ages_psi0.75", "scenario_3.4.2_SB_sample.ALL.ages_psi0.75", "scenario_3.4.3_SB_sample.ALL.ages_psi0.75", "scenario_3.4.4_SB_sample.ALL.ages_psi0.75")
file.scenario_3.4A <- c("scenario_3.4.1_SB_sample.ALL.ages_psi0.75", "scenario_3.4.2_SB_sample.ALL.ages_psi0.75", "scenario_3.4.3_SB_sample.ALL.ages_psi0.75", "scenario_3.4.4_SB_sample.ALL.ages_psi0.75")
purpose.obj3.4.labA <- "Sample all age classes"
model.type.obj3.4A <- "HS + PO"


#-------------Scenario 3.5 --------------------#
#date.of.simulation.scenario_2.2.1Y <- "13Jul2022"
purpose.obj3.5Y <- c("scenario_3.5.1_SB_target.YOY_psi0.5", "scenario_3.5.2_SB_target.YOY_psi0.5", "scenario_3.5.3_SB_target.YOY_psi0.5", "scenario_3.5.4_SB_target.YOY_psi0.5")
file.scenario_3.5Y <- c("scenario_3.5.1_SB_target.YOY_psi0.5", "scenario_3.5.2_SB_target.YOY_psi0.5", "scenario_3.5.3_SB_target.YOY_psi0.5", "scenario_3.5.4_SB_target.YOY_psi0.5")
purpose.obj3.5.labY <- "Target YOY"
model.type.obj3.5Y <- "HS.only"

#date.of.simulation.scenario_3.5.1J <- "13Jul2022"
purpose.obj3.5J <- c("scenario_3.5.1_SB_sample.all.juvenile.ages_psi0.5", "scenario_3.5.2_SB_sample.all.juvenile.ages_psi0.5", "scenario_3.5.3_SB_sample.all.juvenile.ages_psi0.5", "scenario_3.5.4_SB_sample.all.juvenile.ages_psi0.5")
file.scenario_3.5J <- c("scenario_3.5.1_SB_sample.all.juvenile.ages_psi0.5", "scenario_3.5.2_SB_sample.all.juvenile.ages_psi0.5", "scenario_3.5.3_SB_sample.all.juvenile.ages_psi0.5", "scenario_3.5.4_SB_sample.all.juvenile.ages_psi0.5")
purpose.obj3.5.labJ <- "Sample all juvenile ages"
model.type.obj3.5J <- "HS.only"

#date.of.simulation.scenario_3.5.1A <- "13Jul2022"
purpose.obj3.5A <- c("scenario_3.5.1_SB_sample.ALL.ages_psi0.5", "scenario_3.5.2_SB_sample.ALL.ages_psi0.5", "scenario_3.5.3_SB_sample.ALL.ages_psi0.5", "scenario_3.5.4_SB_sample.ALL.ages_psi0.5")
file.scenario_3.5A <- c("scenario_3.5.1_SB_sample.ALL.ages_psi0.5", "scenario_3.5.2_SB_sample.ALL.ages_psi0.5", "scenario_3.5.3_SB_sample.ALL.ages_psi0.5", "scenario_3.5.4_SB_sample.ALL.ages_psi0.5")
purpose.obj3.5.labA <- "Sample all age classes"
model.type.obj3.5A <- "HS + PO"


#-------------Scenario 3.6 --------------------#
#date.of.simulation.scenario_2.2.1Y <- "13Jul2022"
purpose.obj3.6Y <- c("scenario_3.6.1_SB_target.YOY_psi1_fixed", "scenario_3.6.2_SB_target.YOY_psi1_fixed", "scenario_3.6.3_SB_target.YOY_psi1_fixed", "scenario_3.6.4_SB_target.YOY_psi1_fixed")
file.scenario_3.6Y <- c("scenario_3.6.1_SB_target.YOY_psi1_fixed", "scenario_3.6.2_SB_target.YOY_psi1_fixed", "scenario_3.6.3_SB_target.YOY_psi1_fixed", "scenario_3.6.4_SB_target.YOY_psi1_fixed")
purpose.obj3.6.labY <- "Target YOY"
model.type.obj3.6Y <- "HS.only"

#date.of.simulation.scenario_3.6.1J <- "13Jul2022"
purpose.obj3.6J <- c("scenario_3.6.1_SB_sample.all.juvenile.ages_psi1_fixed", "scenario_3.6.2_SB_sample.all.juvenile.ages_psi1_fixed", "scenario_3.6.3_SB_sample.all.juvenile.ages_psi1_fixed", "scenario_3.6.4_SB_sample.all.juvenile.ages_psi1_fixed")
file.scenario_3.6J <- c("scenario_3.6.1_SB_sample.all.juvenile.ages_psi1_fixed", "scenario_3.6.2_SB_sample.all.juvenile.ages_psi1_fixed", "scenario_3.6.3_SB_sample.all.juvenile.ages_psi1_fixed", "scenario_3.6.4_SB_sample.all.juvenile.ages_psi1_fixed")
purpose.obj3.6.labJ <- "Sample all juvenile ages"
model.type.obj3.6J <- "HS.only"

#date.of.simulation.scenario_3.6.1A <- "13Jul2022"
purpose.obj3.6A <- c("scenario_3.6.1_SB_sample.ALL.ages_psi1_fixed", "scenario_3.6.2_SB_sample.ALL.ages_psi1_fixed", "scenario_3.6.3_SB_sample.ALL.ages_psi1_fixed", "scenario_3.6.4_SB_sample.ALL.ages_psi1_fixed")
file.scenario_3.6A <- c("scenario_3.6.1_SB_sample.ALL.ages_psi1_fixed", "scenario_3.6.2_SB_sample.ALL.ages_psi1_fixed", "scenario_3.6.3_SB_sample.ALL.ages_psi1_fixed", "scenario_3.6.4_SB_sample.ALL.ages_psi1_fixed")
purpose.obj3.6.labA <- "Sample all age classes"
model.type.obj3.6A <- "HS + PO"



#-------------Objective 4 --------------------
purpose_4.1.1_vec <- c("scenario_4.1.1_ageMiss_target.YOY", "scenario_4.1.1_ageMiss_sample.all.juvenile.ages", "scenario_4.1.1_ageMiss_sample.ALL.ages")
purpose_4.1.2_vec <- c("scenario_4.1.2_ageMiss_target.YOY", "scenario_4.1.2_ageMiss_sample.all.juvenile.ages", "scenario_4.1.2_ageMiss_sample.ALL.ages")
purpose_4.1.3_vec <- c("scenario_4.1.3_ageMiss_target.YOY", "scenario_4.1.3_ageMiss_sample.all.juvenile.ages", "scenario_4.1.3_ageMiss_sample.ALL.ages")
purpose_4.1.all_vec <- c(purpose_4.1.1_vec, purpose_4.1.2_vec, purpose_4.1.3_vec)

purpose_4.2.1_vec <- c("scenario_4.2.1_ageMiss_target.YOY", "scenario_4.2.1_ageMiss_sample.all.juvenile.ages", "scenario_4.2.1_ageMiss_sample.ALL.ages")
purpose_4.2.2_vec <- c("scenario_4.2.2_ageMiss_target.YOY", "scenario_4.2.2_ageMiss_sample.all.juvenile.ages", "scenario_4.2.2_ageMiss_sample.ALL.ages")
purpose_4.2.3_vec <- c("scenario_4.2.3_ageMiss_target.YOY", "scenario_4.2.3_ageMiss_sample.all.juvenile.ages", "scenario_4.2.3_ageMiss_sample.ALL.ages")

purpose_4.2.all_vec <- c(purpose_4.2.1_vec, purpose_4.2.2_vec, purpose_4.2.3_vec)

purpose_4.3.1_vec <- c("scenario_4.3.1_ageMiss_target.YOY", "scenario_4.3.1_ageMiss_sample.all.juvenile.ages", "scenario_4.3.1_ageMiss_sample.ALL.ages")
purpose_4.3.2_vec <- c("scenario_4.3.2_ageMiss_target.YOY", "scenario_4.3.2_ageMiss_sample.all.juvenile.ages", "scenario_4.3.2_ageMiss_sample.ALL.ages")
purpose_4.3.3_vec <- c("scenario_4.3.3_ageMiss_target.YOY", "scenario_4.3.3_ageMiss_sample.all.juvenile.ages", "scenario_4.3.3_ageMiss_sample.ALL.ages")

purpose_4.3.all_vec <- c(purpose_4.3.1_vec, purpose_4.3.2_vec, purpose_4.3.3_vec)

#Save distinct vector of purposes for each sampling scheme
purpose.obj4Y <- c("scenario_4.1.1_ageMiss_target.YOY", "scenario_4.1.2_ageMiss_target.YOY", "scenario_4.1.3_ageMiss_target.YOY", "scenario_4.2.1_ageMiss_target.YOY", "scenario_4.2.2_ageMiss_target.YOY", "scenario_4.2.3_ageMiss_target.YOY", "scenario_4.3.1_ageMiss_target.YOY", "scenario_4.3.2_ageMiss_target.YOY", "scenario_4.3.3_ageMiss_target.YOY")
file.scenario_4Y <- c("scenario_4.1.1_ageMiss_target.YOY", "scenario_4.1.2_ageMiss_target.YOY", "scenario_4.1.3_ageMiss_target.YOY", "scenario_4.2.1_ageMiss_target.YOY", "scenario_4.2.2_ageMiss_target.YOY", "scenario_4.2.3_ageMiss_target.YOY", "scenario_4.3.1_ageMiss_target.YOY", "scenario_4.3.2_ageMiss_target.YOY", "scenario_4.3.3_ageMiss_target.YOY")
purpose.obj4.labY <- "Target YOY"
model.type.obj4Y <- "HS.only"

#date.of.simulation.scenario_4.1J <- "13Jul2022"
purpose.obj4J <- c("scenario_4.1.1_ageMiss_sample.all.juvenile.ages", "scenario_4.1.2_ageMiss_sample.all.juvenile.ages", "scenario_4.1.3_ageMiss_sample.all.juvenile.ages", "scenario_4.2.1_ageMiss_sample.all.juvenile.ages", "scenario_4.2.2_ageMiss_sample.all.juvenile.ages", "scenario_4.2.3_ageMiss_sample.all.juvenile.ages",
"scenario_4.3.1_ageMiss_sample.all.juvenile.ages", "scenario_4.3.2_ageMiss_sample.all.juvenile.ages", "scenario_4.3.3_ageMiss_sample.all.juvenile.ages")
file.scenario_4J <- c("scenario_4.1.1_ageMiss_sample.all.juvenile.ages", "scenario_4.1.2_ageMiss_sample.all.juvenile.ages", "scenario_4.1.3_ageMiss_sample.all.juvenile.ages", "scenario_4.2.1_ageMiss_sample.all.juvenile.ages", "scenario_4.2.2_ageMiss_sample.all.juvenile.ages", "scenario_4.2.3_ageMiss_sample.all.juvenile.ages",
"scenario_4.3.1_ageMiss_sample.all.juvenile.ages", "scenario_4.3.2_ageMiss_sample.all.juvenile.ages", "scenario_4.3.3_ageMiss_sample.all.juvenile.ages")
purpose.obj4.labJ <- "Sample all juvenile ages"
model.type.obj4J <- "HS.only"

#date.of.simulation.scenario_4.1A <- "13Jul2022"
purpose.obj4A <- c("scenario_4.1.1_ageMiss_sample.ALL.ages", "scenario_4.1.2_ageMiss_sample.ALL.ages", "scenario_4.1.3_ageMiss_sample.ALL.ages", "scenario_4.2.1_ageMiss_sample.ALL.ages", "scenario_4.2.2_ageMiss_sample.ALL.ages", "scenario_4.2.3_ageMiss_sample.ALL.ages", "scenario_4.3.1_ageMiss_sample.ALL.ages", "scenario_4.3.2_ageMiss_sample.ALL.ages", "scenario_4.3.3_ageMiss_sample.ALL.ages")
file.scenario_4A <- c("scenario_4.1.1_ageMiss_sample.ALL.ages", "scenario_4.1.2_ageMiss_sample.ALL.ages", "scenario_4.1.3_ageMiss_sample.ALL.ages", "scenario_4.2.1_ageMiss_sample.ALL.ages", "scenario_4.2.2_ageMiss_sample.ALL.ages", "scenario_4.2.3_ageMiss_sample.ALL.ages", "scenario_4.3.1_ageMiss_sample.ALL.ages", "scenario_4.3.2_ageMiss_sample.ALL.ages", "scenario_4.3.3_ageMiss_sample.ALL.ages")
purpose.obj4.labA <- "Sample all age classes"
model.type.obj4A <- "HS + PO"



seeds <- "Seeds2022.04.15"
```


```{r read in files}
source(file = "~/R/working_directory/LemonSharkCKMR/03_DataViz/functions/truth_calcs.R")
obj1.truth.df
obj2.truth.df
obj3.truth.df_psi1
obj4.truth.df <- obj3.truth.df_psi1 #They're the same

#--------------------- Objective 1 ---------------------------------
#--------------------- Scenario 1.1 ---------------------------------#
#Tight prior on survival
#Files
scenario_1.1_files <- list.files(path = objective_1_results_location,
                            recursive = FALSE,
                            pattern = "*scenario_1.1_*",
                            full.names = TRUE)

#Results
scenario_1.1_results <- map_dfr(scenario_1.1_files, read_csv) %>% 
  mutate(sampling.scheme = ifelse(purpose == purpose.obj1.1Y, "target YOY",
                                  ifelse(purpose == purpose.obj1.1J, "sample all juvenile ages",
                                         "sample all age classes")),
         survival.prior = "informed",
         lambda.prior = "none",
         cv = (sd/mean)*100)

#--------------------- Scenario 1.2 ---------------------------------#
#Diffuse prior on survival
#Files
scenario_1.2_files <- list.files(path = objective_1_results_location,
                            recursive = FALSE,
                            pattern = "*scenario_1.2_*",
                            full.names = TRUE)

#Results
scenario_1.2_results <- map_dfr(scenario_1.2_files, read_csv) %>% 
  mutate(sampling.scheme = ifelse(purpose == purpose.obj1.2Y, "target YOY",
                                  ifelse(purpose == purpose.obj1.2J, "sample all juvenile ages",
                                         "sample all age classes")),
         survival.prior = "diffuse",
         lambda.prior = "none",
         cv = (sd/mean)*100)
  

obj1_results <- scenario_1.1_results %>% bind_rows(scenario_1.2_results) %>% 
  inner_join(obj1.truth.df, by = c("iteration", "sampling.scheme")) %>% 
  mutate(all.truth = ifelse(parameter == "Nm", male.truth,
                            ifelse(parameter == "Nf", female.truth, all.truth))) %>% 
  dplyr::select(-c(male.truth, female.truth)) %>% 
  dplyr::rename(prop.sampled = sample.prop.juvs) %>% 
  mutate(prop.sampled.lab = paste0(prop.sampled, " percent sampled")) %>% 
  dplyr::select(-sample.size.juvs)


write_csv(obj1_results, file = paste0(objective_1_results_location, "obj1_collated_results.csv"))


#--------------------- Objective 2 ---------------------------------
#--------------------- Scenario 2.1 ---------------------------------#
scenario_2.1.1_files <- list.files(path = paste0(objective_2_results_location, "scenario_2.1.1/"),
                            recursive = FALSE,
                            pattern = "*scenario_2.1.1_*",
                            full.names = TRUE)

scenario_2.1.1_files #Double-check that the correct files are imported

scenario_2.1.2_files <- list.files(path = paste0(objective_2_results_location, "scenario_2.1.2/"),
                            recursive = FALSE,
                            pattern = "*scenario_2.1.2_*",
                            full.names = TRUE)

scenario_2.1.2_files #Double-check that the correct files are imported



#Minor population growth
scenario_2.1.1_results <- map_dfr(scenario_2.1.1_files, read_csv) %>% 
  mutate(sampling.scheme = ifelse(purpose %in% purpose.obj2.1Y, "target YOY",
                                  ifelse(purpose %in% purpose.obj2.1J, "sample all juvenile ages",
                                         "sample all age classes")),
         survival.prior = "diffuse",
         lambda.prior = NA,
         cv = (sd/mean)*100,
         adult.survival.adj = 0.825,
         juvenile.survival.adj = 0.8,
                  population.growth = ifelse(population.growth == "lambda.1", "stable", 
                                    ifelse(population.growth != "lambda.1" & iteration <= 500, "slight negative", 
                                           "slight positive")))

#Extreme population decline
scenario_2.1.2_results <- map_dfr(scenario_2.1.2_files, read_csv) %>% 
  mutate(sampling.scheme = ifelse(purpose %in% purpose.obj2.1Y, "target YOY",
                                  ifelse(purpose %in% purpose.obj2.1J, "sample all juvenile ages",
                                         "sample all age classes")),
         survival.prior = "diffuse",
         lambda.prior = NA,
         cv = (sd/mean)*100,
         population.growth = "extreme negative") %>% 
  dplyr::select(-(c(est.yr))) #Don't want to have this in the dataframe; want it to come in when joining with the truth


#Bring in scenario 1.2, which is the same as the stable lambda scenario here
scenario_2.1_stable <- scenario_1.2_results %>% dplyr::filter(sample.prop.juvs == 1.5) %>% 
  mutate(population.growth = "stable")


scenario_2.1_results.all <- scenario_2.1.1_results %>% bind_rows(scenario_2.1.2_results) %>% 
  bind_rows(scenario_2.1_stable) %>% #Add in neutral growth scenario
  inner_join(obj2.truth.df, by = c("iteration", "seed", "population.growth")) %>% 
  mutate(all.truth = ifelse(parameter == "Nm", Male.adult.pop,
                            ifelse(parameter == "Nf", Female.adult.pop, all.truth))) %>% 
  #dplyr::filter(year == 85) %>% 
  dplyr::select(-c(Male.adult.pop, Female.adult.pop))



#--------------------- Scenario 2.2 ---------------------------------#
#Same scenario as 2.1, but add lambda to the model; small variations
scenario_2.2.1_files <- list.files(path = paste0(objective_2_results_location, "scenario_2.2.1/"),
                            recursive = FALSE,
                            pattern = "*scenario_2.2.1_*",
                            full.names = TRUE)

scenario_2.2.1_files

#Bigger variations in lambda; prior expecting population decline
scenario_2.2.2_files <- list.files(path = paste0(objective_2_results_location, "scenario_2.2.2/"),
                            recursive = FALSE,
                            pattern = "*scenario_2.2.2_*",
                            full.names = TRUE)

scenario_2.2.2_files

scenario_2.2.1_results <- map_dfr(scenario_2.2.1_files, read_csv) %>% 
  mutate(sampling.scheme = ifelse(purpose %in% purpose.obj2.2Y, "target YOY",
                                  ifelse(purpose %in% purpose.obj2.2J, "sample all juvenile ages",
                                         "sample all age classes")),
         survival.prior = "diffuse",
         lambda.prior = "diffuse (0.80 - 1.20)",
         cv = (sd/mean)*100,
         adult.survival.adj = 0.825,
         juvenile.survival.adj = 0.8,
         population.growth = ifelse(population.growth == "lambda.1", "stable", 
                                    ifelse(population.growth != "lambda.1" & iteration <= 500, "slight negative", 
                                           "slight positive")))


#Extreme population decline
scenario_2.2.2_results <- map_dfr(scenario_2.2.2_files, read_csv) %>% 
  mutate(sampling.scheme = ifelse(purpose %in% purpose.obj2.2Y, "target YOY",
                                  ifelse(purpose %in% purpose.obj2.2J, "sample all juvenile ages",
                                         "sample all age classes")),
         survival.prior = "diffuse",
         lambda.prior = "diffuse (0.80 - 1.20)",
         cv = (sd/mean)*100,
         population.growth = "extreme negative")

scenario_2.2_results.all <- scenario_2.2.1_results %>% bind_rows(scenario_2.2.2_results) %>% 
#  bind_rows(scenario_2.1_neutral) %>% #Add in neutral growth scenario
  inner_join(obj2.truth.df, by = c("iteration", "seed", "population.growth", "est.yr")) %>% 
  mutate(all.truth = ifelse(parameter == "Nm", Male.adult.pop,
                            ifelse(parameter == "Nf", Female.adult.pop, all.truth))) %>% 
  #dplyr::filter(year == 85) %>% 
  dplyr::select(-c(Male.adult.pop, Female.adult.pop))


#--------------------- Scenario 2.3 ---------------------------------#
#Same scenario as 2.1, but add lambda to the model; small variations
scenario_2.3.1_files <- list.files(path = paste0(objective_2_results_location, "scenario_2.3.1/"),
                            recursive = FALSE,
                            pattern = "*scenario_2.3.1_*",
                            full.names = TRUE)

scenario_2.3.1_files

#Bigger variations in lambda; prior expecting population decline
scenario_2.3.2_files <- list.files(path = paste0(objective_2_results_location, "scenario_2.3.2/"),
                            recursive = FALSE,
                            pattern = "*scenario_2.3.2_*",
                            full.names = TRUE)

scenario_2.3.2_files

scenario_2.3.1_results <- map_dfr(scenario_2.3.1_files, read_csv) %>% 
  mutate(sampling.scheme = ifelse(purpose %in% purpose.obj2.3Y, "target YOY",
                                  ifelse(purpose %in% purpose.obj2.3J, "sample all juvenile ages",
                                         "sample all age classes")),
         survival.prior = "diffuse",
         lambda.prior = "tight (0.95 - 1.05)",
         cv = (sd/mean)*100,
         adult.survival.adj = 0.825,
         juvenile.survival.adj = 0.8,
                  population.growth = ifelse(population.growth == "lambda.1", "stable", 
                                    ifelse(population.growth != "lambda.1" & iteration <= 500, "slight negative", 
                                           "slight positive")))


#Extreme population decline
scenario_2.3.2_results <- map_dfr(scenario_2.3.2_files, read_csv) %>% 
  mutate(sampling.scheme = ifelse(purpose %in% purpose.obj2.3Y, "target YOY",
                                  ifelse(purpose %in% purpose.obj2.3J, "sample all juvenile ages",
                                         "sample all age classes")),
         survival.prior = "diffuse",
         lambda.prior = "tight (0.95 - 1.05)",
         cv = (sd/mean)*100,
         population.growth = "extreme negative")


scenario_2.3_results.all <- scenario_2.3.1_results %>% bind_rows(scenario_2.3.2_results) %>% 
#  bind_rows(scenario_2.1_neutral) %>% #Add in neutral growth scenario
  inner_join(obj2.truth.df, by = c("iteration", "seed", "population.growth", "est.yr")) %>% 
  mutate(all.truth = ifelse(parameter == "Nm", Male.adult.pop,
                            ifelse(parameter == "Nf", Female.adult.pop, all.truth))) %>% 
  #dplyr::filter(year == 85) %>% 
  dplyr::select(-c(Male.adult.pop, Female.adult.pop))


#Combine results for objective 2
obj2_results <- scenario_2.1_results.all %>% bind_rows(scenario_2.2_results.all, scenario_2.3_results.all) %>% 
  # inner_join(obj2.truth.df, by = c("population.growth", "iteration", "est.yr", "seed")) %>% 
  # mutate(all.truth = ifelse(parameter == "Nm", Male.adult.pop,
  #                           ifelse(parameter == "Nf", Female.adult.pop, all.truth))) %>% 
  #dplyr::filter(year == 85) %>% 
  #dplyr::select(-c(Male.adult.pop, Female.adult.pop)) %>% 
  replace_na(list(lambda.prior = "none")) %>% 
  mutate(est.yr.lab = ifelse(est.yr == 80, "10 years past",
                             ifelse(est.yr == 85, "5 years past", "present"))) %>% 
  mutate(relative_bias = round(((Q50 - all.truth)/all.truth)*100, 1)) %>% 
  mutate(in_interval = ifelse(HPD2.5 < all.truth & all.truth < HPD97.5, "Y", "N")) %>% 
  dplyr::select(-sample.size.juvs) %>% 
  mutate(mean.adult.lambda.last10 = ifelse(is.na(mean.adult.lambda.last10) == TRUE, mean.adult.lambda, mean.adult.lambda.last10))


write_csv(obj2_results, file = paste0(objective_2_results_location, "obj2_collated_results.csv"))


#--------------------- objective 3 ---------------------------------
#objective 3.1
obj3_target.YOY_files <- list.files(path = paste0(objective_3_results_location),
                            recursive = FALSE,
                            pattern = "*target.YOY*",
                            full.names = TRUE)

obj3_target.YOY_files

obj3_target.YOY_results <- map_dfr(obj3_target.YOY_files, read_csv) %>% 
  mutate(sampling.scheme = "target YOY")

obj3_sample.all.juveniles_files <- list.files(path = paste0(objective_3_results_location),
                            recursive = FALSE,
                            pattern = "*sample.all.juvenile.ages*",
                            full.names = TRUE)

obj3_sample.all.juveniles_files

obj3_sample.all.juveniles_results <- map_dfr(obj3_sample.all.juveniles_files, read_csv) %>% 
  mutate(sampling.scheme = "sample all juveniles")

obj3_sample.ALL.ages_files <- list.files(path = paste0(objective_3_results_location),
                            recursive = FALSE,
                            pattern = "*sample.ALL.ages*",
                            full.names = TRUE)

obj3_sample.ALL.ages_files

obj3_sample.ALL.ages_results <- map_dfr(obj3_sample.ALL.ages_files, read_csv) %>% 
  mutate(sampling.scheme = "sample ALL ages")

annual.scenarios <- c("scenario_3.1.1", "scenario_3.2.1", "scenario_3.3.1", "scenario_3.4.1", "scenario_3.5.1")

multiennial.scenarios <- c("scenario_3.1.2", "scenario_3.2.2", "scenario_3.3.2", "scenario_3.4.2", "scenario_3.5.2")

obj3_results <- bind_rows(obj3_target.YOY_results, obj3_sample.all.juveniles_results, obj3_sample.ALL.ages_results) %>% mutate(model = ifelse(scenario %in% annual.scenarios, "annual", "multiennial")) %>% 
  mutate(popsim.psi = ifelse(scenario == "scenario_3.1.1" | scenario == "scenario_3.1.2", 1, 
                             ifelse(scenario == "scenario_3.2.1" | scenario == "scenario_3.2.2", 0.9,
                             ifelse(scenario == "scenario_3.3.1" | scenario == "scenario_3.3.2", 0.75,
                             ifelse(scenario == "scenario_3.4.1" | scenario == "scenario_3.4.2", 0.5, 1))))) %>% 
  mutate(mating.periodicity = ifelse(scenario == "scenario_3.5.1" | scenario == "scenario_3.5.2", 3, 2)) %>% 
  mutate(cv = (sd/mean)*100)

write_csv(obj3_results, file = paste0(objective_3_results_location, "obj3_collated_results.csv"))

#--------------------- objective 4 ---------------------------------
#objective 4.1
obj4_target.YOY_files <- list.files(path = paste0(objective_4_results_location),
                            recursive = FALSE,
                            pattern = "*target.YOY*",
                            full.names = TRUE)

obj4_target.YOY_files

obj4_target.YOY_results <- map_dfr(obj4_target.YOY_files, read_csv) %>% 
  mutate(sampling.scheme = "target YOY")

obj4_sample.all.juveniles_files <- list.files(path = paste0(objective_4_results_location),
                            recursive = FALSE,
                            pattern = "*sample.all.juvenile.ages*",
                            full.names = TRUE)

obj4_sample.all.juveniles_files

obj4_sample.all.juveniles_results <- map_dfr(obj4_sample.all.juveniles_files, read_csv) %>% 
  mutate(sampling.scheme = "sample all juveniles")

obj4_sample.ALL.ages_files <- list.files(path = paste0(objective_4_results_location),
                            recursive = FALSE,
                            pattern = "*sample.ALL.ages*",
                            full.names = TRUE)

obj4_sample.ALL.ages_files

obj4_sample.ALL.ages_results <- map_dfr(obj4_sample.ALL.ages_files, read_csv) %>% 
  mutate(sampling.scheme = "sample ALL ages")

annual.scenarios <- c("scenario_4.1.1_5CV", "scenario_4.1.2_10CV", "scenario_4.1.3_20CV")

multiennial.scenarios <- c("scenario_4.2.1_5CV", "scenario_4.2.2_10CV", "scenario_4.2.3_20CV")

obj4_results <- bind_rows(obj4_target.YOY_results, obj4_sample.all.juveniles_results, obj4_sample.ALL.ages_results) %>% mutate(model = ifelse(scenario %in% annual.scenarios, "annual", "multiennial")) %>%
  mutate(age.error_cv = ifelse(scenario == "scenario_4.1.1_5CV" | scenario == "scenario_4.2.1_5CV", "5% CV",
                               ifelse(scenario == "scenario_4.1.2_10CV" | scenario == "scenario_4.2.2_10CV", "10% CV", "20% CV"))) %>% 
  mutate(age.error_cv = factor(age.error_cv, levels = c("5% CV", "10% CV", "20% CV"))) %>% 
  mutate(cv = (sd/mean)*100)


write_csv(obj4_results, file = paste0(objective_4_results_location, "obj4_collated_results.csv"))

# #--------------------- Objective 4 ---------------------------------
# #Load everything together
# #Files
# scenario_4_files <- list.files(path = paste0(objective_4_results_location, "liz.model/"),
#                             recursive = FALSE,
#                             pattern = "*scenario_4_*",
#                             full.names = TRUE)
# 
# scenario_4_files
# 
# #Results
# obj4_results <- map_dfr(scenario_4_files, read_csv) %>% 
#   mutate(sampling.scheme = ifelse(purpose %in% purpose.obj4Y, "target YOY",
#                                   ifelse(purpose %in% purpose.obj4J, "sample all juvenile ages",
#                                          "sample all ages")),
#          survival.prior = "diffuse",
#          cv = (sd/mean)*100) %>% 
#   mutate(lambda.prior = ifelse(purpose %in% c(purpose_4.1.1_vec, purpose_4.2.1_vec, purpose_4.3.1_vec), "diffuse",
#                                       ifelse(purpose %in% c(purpose_4.1.2_vec, purpose_4.2.2_vec, purpose_4.3.2_vec), "tight",
#                                              "none"))) %>% 
#   mutate(miss.cv = ifelse(purpose %in% purpose_4.1.all_vec, 0.05,
#                           ifelse(purpose %in% purpose_4.2.all_vec, 0.10, 0.20)))
# 
#   write_csv(obj4_results, file = paste0(objective_4_results_location, "obj4_collated_results_Liz.csv"))
 ```
# 
```{r Obj4 - Read in sample files}
#Read in sample files from age misassignment simulations
#Have to read in separately bc didn't save a column to distinguish each scenario from the others in the sample dataframes
#---------------------Read in sample files-------------------

# Note that sample sizes may be different than what's recorded in the sample.size.total column for two reasons: 1) I multiply the number of samples for the final year of the simulation by the number of years samples were drawn from, so there's error there, and 2) the sample dataframe here is saved AFTER removing self-recaptures.

#---------------------Annual model------------------------
#Scenario 4.1.1 - 5% CV
s4.1.1_all.ages <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.1.1_5CV_annual.model_sample.ALL.ages")

s4.1.1_all.juvs <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.1.1_5CV_annual.model_sample.all.juvenile.ages")

s4.1.1_YOY <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.1.1_5CV_annual.model_target.YOY")

s4.1.1_all <- bind_rows(s4.1.1_all.ages, s4.1.1_all.juvs, s4.1.1_YOY) %>% 
  mutate(model = "annual",
         age.cv = "5% CV")

#Scenario 4.1.2 - 10% CV
s4.1.2_all.ages <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.1.2_10CV_annual.model_sample.ALL.ages")

s4.1.2_all.juvs <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.1.2_10CV_annual.model_sample.all.juvenile.ages")

s4.1.2_YOY <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.1.2_10CV_annual.model_target.YOY")

s4.1.2_all <- bind_rows(s4.1.2_all.ages, s4.1.2_all.juvs, s4.1.2_YOY) %>% 
  mutate(model = "annual",
         age.cv = "10% CV")


#Scenario 4.1 - 5% CV
s4.1.3_all.ages <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.1.3_20CV_annual.model_sample.ALL.ages")

s4.1.3_all.juvs <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.1.3_20CV_annual.model_sample.all.juvenile.ages")

s4.1.3_YOY <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.1.3_20CV_annual.model_target.YOY")

s4.1.3_all <- bind_rows(s4.1.3_all.ages, s4.1.3_all.juvs, s4.1.3_YOY) %>% 
  mutate(model = "annual",
         age.cv = "20% CV")


#---------------------multiennial model------------------------
#Scenario 4.2.1 - 5% CV
s4.2.1_all.ages <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.2.1_5CV_multiennial.model_sample.ALL.ages")

s4.2.1_all.juvs <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.2.1_5CV_multiennial.model_sample.all.juvenile.ages")

s4.2.1_YOY <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.2.1_5CV_multiennial.model_target.YOY")

s4.2.1_all <- bind_rows(s4.2.1_all.ages, s4.2.1_all.juvs, s4.2.1_YOY) %>% 
  mutate(model = "multiennial",
         age.cv = "5% CV")

#Scenario 4.2.2 - 10% CV
s4.2.2_all.ages <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.2.2_10CV_multiennial.model_sample.ALL.ages")

s4.2.2_all.juvs <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.2.2_10CV_multiennial.model_sample.all.juvenile.ages")

s4.2.2_YOY <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.2.2_10CV_multiennial.model_target.YOY")

s4.2.2_all <- bind_rows(s4.2.2_all.ages, s4.2.2_all.juvs, s4.2.2_YOY) %>% 
  mutate(model = "multiennial",
         age.cv = "10% CV")


#Scenario 4.2 - 5% CV
s4.2.3_all.ages <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.2.3_20CV_multiennial.model_sample.ALL.ages")

s4.2.3_all.juvs <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.2.3_20CV_multiennial.model_sample.all.juvenile.ages")

s4.2.3_YOY <- readRDS(file = "G://My Drive/Personal_Drive/R/CKMR/Objective.4_aging.error/Nov2022/Model.results/samples/samples.missassigned_28Nov2022_Seeds2022.04.15_scenario_4.2.3_20CV_multiennial.model_target.YOY")

s4.2.3_all <- bind_rows(s4.2.3_all.ages, s4.2.3_all.juvs, s4.2.3_YOY) %>% 
  mutate(model = "multiennial",
         age.cv = "20% CV")


scenario_4.samps <- bind_rows(s4.1.1_all, s4.1.2_all, s4.1.3_all,
                              s4.2.1_all, s4.2.2_all, s4.2.3_all) %>%
  mutate(yrs.off = age.miss - age.x)

write_csv(scenario_4.samps, file = paste0(objective_4_results_location, "scenario_4.samps.csv"))
# 
# #-------------------------Format results files -------------------------
# #Lambda in model w/ wide prior
# #Correctly assigned ages: scenario_3.2.2
# obj4_diffuse.lam_ages.corr <- scenario_3.2.2_results.liz %>% 
#   mutate(scenario = "ages correctly assigned")
# 
# s.temp <- obj4_diffuse.lam_ages.corr %>% 
#   group_by(parameter, sampling.scheme, lambda.prior, scenario) %>% 
#   dplyr::summarize(percent_in_interval = sum(in_interval == "Y")/n() * 100,
#                    median.bias = median(relative_bias),
#                    mean.cv = mean(cv)) %>%
#   dplyr::arrange(parameter, sampling.scheme) %>% 
#   mutate(miss.cv = 0)
# 
# 
# #Misassigned ages: scenario_4.1
# obj4_diffuse.lam_ages.miss <- obj4_results %>% dplyr::filter(lambda.prior == "diffuse") %>% 
#   mutate(scenario = "ages misassigned")
# 
# obj4_diffuse.lam_summ <- obj4_diffuse.lam_ages.miss %>% 
#   group_by(parameter, sampling.scheme, lambda.prior, scenario, miss.cv) %>% 
#   dplyr::summarize(percent_in_interval = sum(in_interval == "Y")/n() * 100,
#                    median.bias = median(relative_bias),
#                    mean.cv = mean(cv)) %>%
#   dplyr::arrange(parameter, sampling.scheme) %>% 
#   bind_rows(s.temp)
# 
# obj4_diffuse.lam_summ %>% arrange(parameter, sampling.scheme, scenario, miss.cv) %>% 
#   View()
# 
# #Lambda in model w/ tight prior
# #Correctly assigned ages: scenario_3.3.3
# obj4_tight.lam_ages.corr <- scenario_3.2.3_results.liz %>% 
#   mutate(scenario = "ages correctly assigned")
# 
# s.temp <- obj4_tight.lam_ages.corr %>% group_by(sampling.scheme) %>% 
#   group_by(parameter, sampling.scheme, lambda.prior, scenario) %>% 
#   dplyr::summarize(percent_in_interval = sum(in_interval == "Y")/n() * 100,
#                    median.bias = median(relative_bias),
#                    mean.cv = mean(cv)) %>%
#   dplyr::arrange(parameter, sampling.scheme) %>% 
#   mutate(miss.cv = 0)
# 
# 
# 
# #Misassigned ages: scenario_4.2
# obj4_tight.lam_ages.miss <- obj4_results %>% dplyr::filter(lambda.prior == "tight") %>% 
#   mutate(scenario = "ages misassigned")
# 
# obj4_tight.lam_summ <- obj4_tight.lam_ages.miss %>% 
#   group_by(parameter, sampling.scheme, lambda.prior, scenario, miss.cv) %>% 
#   dplyr::summarize(percent_in_interval = sum(in_interval == "Y")/n() * 100,
#                    median.bias = median(relative_bias),
#                    mean.cv = mean(cv)) %>%
#   dplyr::arrange(parameter, sampling.scheme) %>% 
#   bind_rows(s.temp)
# 
# obj4_tight.lam_summ %>% arrange(parameter, sampling.scheme, scenario, miss.cv) %>% 
#   View()
# 
# 
# #Lambda NOT in model
# #Correctly assigned ages: scenario_3.2.1
# obj4_no.lam_ages.corr <- scenario_3.2.1_results.liz %>% 
#   mutate(scenario = "ages correctly assigned") %>% 
#   mutate(sampling.scheme = ifelse(sampling.scheme == "sample all age classes", "sample all ages", sampling.scheme))
# 
# s.temp <- obj4_no.lam_ages.corr %>% group_by(sampling.scheme) %>% 
#   group_by(parameter, sampling.scheme, lambda.prior, scenario) %>% 
#   dplyr::summarize(percent_in_interval = sum(in_interval == "Y")/n() * 100,
#                    median.bias = median(relative_bias),
#                    mean.cv = mean(cv)) %>%
#   dplyr::arrange(parameter, sampling.scheme) %>% 
#     mutate(miss.cv = 0)
# 
# 
# 
# #Misassigned ages: scenario_4.3
# obj4_no.lam_ages.miss <- obj4_results %>% dplyr::filter(lambda.prior == "none") %>% 
#     mutate(scenario = "ages misassigned")
# 
# obj4_no.lam_summ <- obj4_no.lam_ages.miss %>% 
#   group_by(parameter, sampling.scheme, lambda.prior, scenario, miss.cv) %>% 
#   dplyr::summarize(percent_in_interval = sum(in_interval == "Y")/n() * 100,
#                    median.bias = median(relative_bias),
#                    mean.cv = mean(cv)) %>%
#   dplyr::arrange(parameter, sampling.scheme) %>% 
#   bind_rows(s.temp)
# 
# obj4_no.lam_summ %>% arrange(parameter, sampling.scheme, scenario, miss.cv) %>% 
#   View()
# 
# #Summary of results
# obj4.all_summ <- bind_rows(obj4_no.lam_summ, obj4_diffuse.lam_summ, obj4_tight.lam_summ)
# 
# write_rds(obj4.all_summ, file = paste0(objective_4_results_location, "obj4.all_summary"))
# 
# 
# #Prep dataframe for plotting
# obj4.all_results <- obj4_no.lam_ages.corr %>% bind_rows(obj4_no.lam_ages.miss, obj4_tight.lam_ages.corr, obj4_tight.lam_ages.miss, obj4_diffuse.lam_ages.corr, obj4_diffuse.lam_ages.miss) %>% 
#   mutate(lambda.prior_lab = ifelse(lambda.prior == "none", "No lambda",
#                                    ifelse(lambda.prior == "tight", "Tight prior on lambda", "Diffuse prior on lambda"))) %>% 
#   mutate(lambda.prior_lab = factor(lambda.prior_lab, levels = c("No lambda", "Tight prior on lambda", "Diffuse prior on lambda")))
# 
# write_rds(obj4.all_results, file = paste0(objective_4_results_location, "obj4.all_results_forPlotting"))
```